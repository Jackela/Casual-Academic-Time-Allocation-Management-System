# Tasks: API Alignment Fixes (003)

Input: specs/003-api-alignment-fixes/
Prerequisites: plan.md (required), spec.md (required), research.md, data-model.md, contracts/, quickstart.md

Notes:
- Tests are requested (test‑first contract alignment for Courses→Tutors).
- Organize by user story; keep tasks independently verifiable.

## Phase 1: Setup (Shared Infrastructure)

- [ ] T001 Confirm feature branch `003-api-alignment-fixes` is checked out
- [ ] T002 Ensure spec and plan present: `specs/003-api-alignment-fixes/spec.md`, `specs/003-api-alignment-fixes/plan.md`
- [ ] T003 [P] Validate Playwright project selection includes real API suite in `frontend/playwright.config.ts`

---

## Phase 2: Foundational (Blocking Prerequisites)

- [ ] T004 Ensure OpenAPI contract scaffold exists at `specs/003-api-alignment-fixes/contracts/openapi.yml`
 - [ ] T005 [P] Verify API runner works locally: `node scripts/e2e-runner.js --project=real --grep=@api` and record exit code/log to `uat-artifacts/current/runner-smoke.txt` (non-zero exit fails)

Checkpoint: After T004–T005, proceed with user stories in parallel.

---

## Phase 3: User Story 1 – Course Tutors response alignment (Priority: P1)

Goal: Align GET `/api/courses/{courseId}/tutors` response to `{ tutorIds: number[] }` and keep ACL intact.

- [ ] T010 [P] [US1] Update API test to assert `{ tutorIds: number[] }` in `frontend/e2e/real/api/courses-tutors.spec.ts`
- [ ] T011 [US1] Update controller to return `{ tutorIds }` in `src/main/java/com/usyd/catams/controller/CourseUsersController.java` (remove any legacy/dual-shape fallback)
- [ ] T012 [P] [US1] Update contract schema for Courses→Tutors in `specs/003-api-alignment-fixes/contracts/openapi.yml`
- [ ] T013 [P] [US1] Verify frontend fetch uses `{ tutorIds }` in `frontend/src/api/courses.ts:fetchCourseTutors` and confirm UI renders list without errors (no console errors)
- [ ] T014 [US1] Run API‑only suite and confirm green: `node scripts/e2e-runner.js --project=real --grep=@api` (record results in PR)

---

## Phase 4: User Story 2 – Regression‑preventing tests (Priority: P2)

Goal: Ensure contract drift is caught in CI with clear failures.

- [ ] T020 [P] [US2] Extend negative cases (invalid id, unauthorized) to assert `{ tutorIds }` remains the response wrapper in `frontend/e2e/real/api/courses-tutors.spec.ts`
- [ ] T021 [US2] Ensure CI reporters (JSON/JUnit) generated by Playwright in `frontend/playwright.config.ts` (JSON -> `frontend/playwright-report/results.json`, JUnit -> `frontend/playwright-report/junit.xml`) and documented in quickstart

---

## Phase 5: User Story 3 – Contract & Quickstart (Priority: P3)

Goal: Keep docs aligned and runnable.

- [ ] T030 [P] [US3] Finalize quickstart with API‑only/full suite commands in `specs/003-api-alignment-fixes/quickstart.md`
- [ ] T031 [US3] Cross‑reference contract path from `specs/003-api-alignment-fixes/spec.md` (Contracts section)

---

## Phase N: Polish & Cross‑Cutting

- [ ] T040 [P] Re‑run full Playwright suite and attach report: `node scripts/e2e-runner.js --project=real`
- [ ] T041 Summarize changes and artifacts in PR description (specs + contract + tests)

---

## Dependencies & Execution Order

- Phase 1 → Phase 2 → User Story phases → Polish.
- US1 is independent after Foundational. US2 depends on US1’s schema. US3 can proceed in parallel after Phase 2.

## Parallel Execution Examples

- Parallel: T010, T012, T013 (distinct files: test, contract, frontend API file)
- Sequential: T011 after T010 (test first), then T014 validation

## Implementation Strategy

- MVP: Complete Phase 3 (US1) — backend shape + passing API tests
- Incremental: Add US2 tests strengthening drift detection; finalize docs in US3; finish with a full E2E run

*** End of Tasks ***
